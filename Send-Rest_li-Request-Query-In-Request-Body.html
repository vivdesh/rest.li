<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128576866-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-128576866-1');
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>

    <title>Send Rest.li request query in request Body</title>
    <meta name="description" content="Rest.li protocol specifies what HTTP method will be used for each type of Rest.li request. However, sometimes due to security constraint or jetty buffer limi..." />

    <link rel="icon" type="image/png" href="/rest.li/assets/images/icon_pegasus.png">
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/rest.li/assets/css/main.css">
    <link rel="canonical" href="/rest.li/Send-Rest_li-Request-Query-In-Request-Body" />
    <link rel="alternate" type="application/rss+xml" title="rest.li" href="/rest.li/feed.xml" />

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <script src="//code.jquery.com/jquery-3.0.0.min.js"></script>
    <script src="/rest.li/assets/js/search-input.js"></script>
    

    
    <script>
       $(function() {
          $("h1").addClass("no_toc");
       });
    </script>
</head>


  <body>

    <nav class="dark-grey" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" class="brand-logo" href="/rest.li/">Rest.li</a>
      <ul class="right hide-on-med-and-down">
        
        <li>
          <a href="/rest.li/get_started/quick_start" >
            Getting Started
          </a>
        </li>
        
        <li>
          <a href="/rest.li/user_guide/server_architecture" >
            User Guide
          </a>
        </li>
        
        <li>
          <a href="/rest.li/spec/protocol" >
            API Reference
          </a>
        </li>
        
        <li>
          <a href="/rest.li/contribute/howto" >
            Contribute
          </a>
        </li>
        
          <li>
            <div class="center row" >
              <div class="col s12 ">
                <div class="row">
                  <div class="input-field col s6 s12 min">
                      <i id="search-txt" class="material-icons prefix">search</i>
                      <input type="text" id="search-input">
                    </div>
                  </div>
                </div>
              </div>
          </li>
          <li>
              <a id="github-menu" href="http://github.com/linkedin/rest.li/" >
                   <i class="fa fa-github"></i>
                </a>
          </li>
          </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
</nav>



        <div class="container">
        <div class="row">
                <div class="col s12 m4 l3"> 
               
                    
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">User Guide</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/user_guide/server_architecture">Rest.li Architecture</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_server">Rest.li Server</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_client">Rest.li Client Framework</a></li>
                       
                         <li><a href="/rest.li/user_guide/unstructured_data">Unstructured Data</a></li>
                       
                         <li><a href="/rest.li/Components">Components</a></li>
                       
                         <li><a href="/rest.li/Asynchronous-Servers-and-Clients-in-Rest_li">Asynchronous in Rest.li</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Data Schemas</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/pdl_schema">PDL Schema</a></li>
                       
                         <li><a href="/rest.li/pdsc_syntax">PDSC Syntax</a></li>
                       
                         <li><a href="/rest.li/pdl_migration">Migrating from PDSC to PDL</a></li>
                       
                         <li><a href="/rest.li/avro_translation">Avro Translation</a></li>
                       
                         <li><a href="/rest.li/java_binding">Java Binding</a></li>
                       
                         <li><a href="/rest.li/annotation_processor">Schema Annotation Processor</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Modeling Resources</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/modeling/modeling">Modeling Resources</a></li>
                       
                         <li><a href="/rest.li/modeling/compatibility_check">Snapshots and Resource Compatibility Checking</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Data</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/how_data_is_serialized_for_transport">How Data is Serialized for Transport</a></li>
                       
                         <li><a href="/rest.li/how_data_is_represented_in_memory">How Data is Represented in Memory</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Main concepts</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Rest_li-Filters">Filters</a></li>
                       
                         <li><a href="/rest.li/Projections">Projections</a></li>
                       
                         <li><a href="/rest.li/pathspec">PathSpecs</a></li>
                       
                         <li><a href="/rest.li/Validation-in-Rest_li">Validation</a></li>
                       
                         <li><a href="/rest.li/Attachment-Streaming">Attachment Streaming</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Mutli-language</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/multi_language_compatibility_matrix">Compatibility Matrix</a></li>
                       
                         <li><a href="/rest.li/test_suite">Test Suite</a></li>
                       
                         <li><a href="https://github.com/mchen07/restli-csharp">C#</a></li>
                       
                         <li><a href="/rest.li/Scala-Integration">Scala Integration</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Testing</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Writing-unit-tests-for-Rest_li-clients-and-servers">Writing Unit Tests</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">How to</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Send-Rest_li-Request-Query-In-Request-Body">Send Request Query in the Body</a></li>
                       
                         <li><a href="/rest.li/How-to-use-projections-in-Java">Use Projections</a></li>
                       
                         <li><a href="/rest.li/Rest_li_Avro_conversions">Avro Conversion</a></li>
                       
                         <li><a href="/rest.li/Compression">Compression</a></li>
                       
                         <li><a href="/rest.li/Rest_li-2_x-upgrade-instructions">Migrate to Rest.li 2.x</a></li>
                       
                         <li><a href="/rest.li/testsuite_how_to">Test Suite</a></li>
                       
                         <li><a href="/rest.li/howto_add_new_language">Test Suite - Add New Language</a></li>
                       
                         <li><a href="/rest.li/user_guide/service_errors_java">Configure Service Errors in Java</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">FAQ</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Data-FAQ">Rest.li - FAQ</a></li>
                       
                         <li><a href="/rest.li/testsuite_troubleshooting">Test Suite - Troubleshooting</a></li>
                       
                        </ul>
                     </ul>
                        
                    </div>
                     <div class="markdown-body col s12 m3 l9">
                            <h1 id="send-restli-request-query-in-request-body">Send Rest.li request query in request Body</h1>

<h2 id="contents">Contents</h2>

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#clientquerytunnelfilter-and-serverquerytunnelfilter">ClientQueryTunnelFilter and
ServerQueryTunnelFilter</a></li>
  <li><a href="#request-without-body">Request Without Body</a></li>
  <li><a href="#request-with-body">Request With Body</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>The <a href="spec/protocol">Rest.li protocol</a> specifies what HTTP method will be used for each type of Rest.li request. However, sometimes due to security constraint  (i.e. not wanting to send some sensitive information in URI) or jetty buffer limitation (i.e. there may pose a threshold on the longest query that can go through), it may be required to customize the HTTP method used to send a particular Rest.li request to a Rest.li server.</p>

<h2 id="clientquerytunnelfilter-and-serverquerytunnelfilter">ClientQueryTunnelFilter and ServerQueryTunnelFilter</h2>

<p>Rest.li has provided
<a href="https://github.com/linkedin/rest.li/blob/master/r2-core/src/main/java/com/linkedin/r2/filter/transport/ClientQueryTunnelFilter.java">ClientQueryTunnelFilter</a>
(R2 client filter) and
<a href="https://github.com/linkedin/rest.li/blob/master/r2-core/src/main/java/com/linkedin/r2/filter/transport/ServerQueryTunnelFilter.java">ServerQueryTunnelFilter</a>
(R2 server filter) to support such HTTP method customization. These two
filters behaves as follows:</p>

<ul>
  <li>On sending a rest request from client, ClientQueryTunnelFilter will
invoke
<a href="https://github.com/linkedin/rest.li/blob/master/r2-core/src/main/java/com/linkedin/r2/message/QueryTunnelUtil.java">QueryTunnelUtil</a>
encoding function to encode a standard non-POST rest.li request by
moving the query param line into the body, and reformulating the
request as a POST. The original method is specified by the
<code class="highlighter-rouge">X-HTTP-Method-Override</code> header. This header is important to
indicate that on the server side we should invoke QueryTunnelUtil
decoding function to get back original request so that this
conversion looks completely transparent to users. User can indicate
whether they want to perform such encoding in two ways:</li>
</ul>

<!-- end list -->

<ol>
  <li>Either by specifying a queryPostThreshold in initializing
ClientQueryTunnelFilter. That means if the rest request raw query
length is greater than this specified queryPostTreshold,
ClientQueryTunnelFilter will automatically convert this request to
POST.</li>
  <li>Or by forcing request conversion to specify in request context
    <code class="highlighter-rouge">
       requestContext.putLocalAttr(R2Constants.FORCE_QUERY_TUNNEL, true);
   </code></li>
</ol>

<!-- end list -->

<ul>
  <li>On receiving a rest request at server, ServerQueryTunnelFilter will
invoke QueryTunnelUtil.decode to convert request back to its
original form based on a special header set by
ClientQueryTunnelFilter, that is, <code class="highlighter-rouge">X-HTTP-Method-Override</code>.</li>
</ul>

<h2 id="request-without-body">Request Without Body</h2>

<p>For a rest.li request without body, for example, a BATCH_GET request
like this <code class="highlighter-rouge">http://localhost?ids=List(1,2,3)</code>, the transformed POST
request is x-www-form-urlencoded with query params stored in the body,
as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST http://localhost <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"X-HTTP-Method-Override: GET"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/x-www-form-urlencoded"</span> <span class="se">\</span>
  <span class="nt">--data</span> <span class="s1">$'ids=1,2,3'</span> 
</code></pre></div></div>

<p>Basically,</p>

<ul>
  <li>change GET to POST (<code class="highlighter-rouge">-X POST</code>)</li>
  <li>add X-HTTP-Method-Override header for original HTTP method (<code class="highlighter-rouge">-H
"X-HTTP-Method-Override: GET"</code>)</li>
  <li>add Content-Type header (<code class="highlighter-rouge">-H "Content-Type:
application/x-www-form-urlencoded"</code>)</li>
  <li>move all the query string to body (@—data $’ids=List(1,2,3)’)<br />
Note that if QueryTunnelUtil need to do actual encoding or decoding,
the request would be fully buffered first,<br />
even if it’s streaming.<br />
We believe QueryTunnelUtil is almost exclusively for GET requests,
practically no use case would require<br />
excessively long query for POST &amp; PUT, and we’d be surprised if
anyone is using QueryTunnelUtil for PUT &amp; GET.<br />
Hence, fully buffering request that has to be encoded/decoded is
practically not a problem and gives up the best<br />
return for the investment of our efforts.</li>
</ul>

<h2 id="request-with-body">Request With Body</h2>

<p>For a rest.li request with body, for example, a BATCH_UPDATE request
like this <code class="highlighter-rouge">http://localhost?ids=List(1,2,3)</code>, the transformed POST
request will be of Content-Type of multipart/mixed with 2 sections:</p>

<ol>
  <li>The first section should be of type x-www-form-urlencoded and
contain the query params</li>
  <li>The second should contain what would have been the original body,
along with it’s associated content-type.</li>
</ol>

<p>It will look as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST http://localhost <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"X-HTTP-Method-Override: PUT"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: multipart/mixed; boundary=xyz"</span> <span class="se">\</span>
  <span class="nt">--data</span> <span class="s1">$'--xyz</span><span class="se">\r\n</span><span class="s1">Content-Type: application/x-www-form-urlencoded</span><span class="se">\r\n\r\n</span><span class="s1">ids=List(1,2,3)</span><span class="se">\r\n</span><span class="s1">--xyz</span><span class="se">\r\n</span><span class="s1"> 
         Content-Type: application/json</span><span class="se">\r\n\r\n</span><span class="s1">{"foo":"bar"}</span><span class="se">\r\n</span><span class="s1">--xyz--'</span> 
</code></pre></div></div>

<p>Here,</p>

<ul>
  <li>change GET to POST (<code class="highlighter-rouge">-X POST</code>)</li>
  <li>add X-HTTP-Method-Override header for original HTTP method (<code class="highlighter-rouge">-H
"X-HTTP-Method-Override: GET"</code>)</li>
  <li>add Content-Type header (<code class="highlighter-rouge">-H "Content-Type: multipart/mixed;
boundary=xyz"</code>). Note that here we need to specify a boundary
delimiter (here we use <code class="highlighter-rouge">xyz</code> for illustration) for multipart body,
this delimiter needs to be unique and not appearing in your request
content body or url.</li>
  <li>move all the query string and original request body to body as two
sections explained above.</li>
</ul>

                     </div>
                   </div>
</div>



      <footer class="page-footer">
    <div class="container">
      <div class="row">
        <div class="col s6">
          <h5>Rest.li</h5>
          <p class="text-lighten-4">Rest.li is an open source REST framework for building robust, scalable RESTful architectures using type-safe bindings and asynchronous, non-blocking IO. Rest.li fills a niche for applying RESTful principles at scale with an end-to-end developer workflow for building REST APIs, which promotes clean REST practices, uniform interface design and consistent data modeling.</p>
        </div>
        <div class="col s5 offset-s1">
          <h5 class="black-text">Community</h5>
          <ul>
              <li>GitHub <a class="" href="https://github.com/linkedin/rest.li">Rest.li</a></li>
              <li>LinkedIn <a class="" href="https://www.linkedin.com/groups/4855943/">Rest.li Group</a></li>
            <li>Follow us on twitter: <a class="" href="https://twitter.com/rest_li"> @rest_li</a></li>
            <li>Issue Tracking: <a class="" href="https://github.com/linkedin/rest.li/issues">GitHub issue tracking</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
        <div class="container">
            <div class="row">
              <div class="col s6">
                      Copyright 2018 LinkedIn Corporation </br>
                      This work is licensed under a <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.  </br>
                      For clarity, no trademark is licensed.
                      </br></br>
              </div>
              <div class="col s5 offset-s1">
                      This work was made by using Jekyll (and a Jekyll Starter Template)</br>
                      <a target="_blank" href="https://github.com/macrod68/jekyll-materialize-starter-template">https://github.com/macrod68/jekyll-materialize-starter-template</a></br>
                      Copyright © 2017 Marco Damiani. Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a></br>
                      License:<a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a>
              </div>
            </div>
        </div>
    </div>
    <script>
      $(function() {
        return $("h2, h3, h4, h5, h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
      </script>
</footer>

      
    <!--  Scripts-->                                                                               
<script src="/rest.li/assets/js/jquery.min.js"></script>
<script src="/rest.li/assets/js/materialize.min.js"></script>
<script src="/rest.li/assets/js/init.js"></script>

  </body>

</html>
