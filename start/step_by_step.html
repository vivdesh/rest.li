<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128576866-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-128576866-1');
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>

    <title>Quickstart - A Tutorial Introduction to Rest.li</title>
    <meta name="description" content="Quickstart - A step by step tutorial introduction to Rest.li. Create a Rest.li Server and Client." />

    <link rel="icon" type="image/png" href="/rest.li/assets/images/icon_pegasus.png">
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/rest.li/assets/css/main.css">
    <link rel="canonical" href="/rest.li/start/step_by_step" />
    <link rel="alternate" type="application/rss+xml" title="rest.li" href="/rest.li/feed.xml" />

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <script src="//code.jquery.com/jquery-3.0.0.min.js"></script>
    <script src="/rest.li/assets/js/search-input.js"></script>
    

    
    <script>
       $(function() {
          $("h1").addClass("no_toc");
       });
    </script>
</head>


  <body>

    <nav class="dark-grey" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" class="brand-logo" href="/rest.li/">Rest.li</a>
      <ul class="right hide-on-med-and-down">
        
        <li>
          <a href="/rest.li/get_started/quick_start" >
            Getting Started
          </a>
        </li>
        
        <li>
          <a href="/rest.li/user_guide/server_architecture" >
            User Guide
          </a>
        </li>
        
        <li>
          <a href="/rest.li/spec/protocol" >
            API Reference
          </a>
        </li>
        
        <li>
          <a href="/rest.li/contribute/howto" >
            Contribute
          </a>
        </li>
        
          <li>
            <div class="center row" >
              <div class="col s12 ">
                <div class="row">
                  <div class="input-field col s6 s12 min">
                      <i id="search-txt" class="material-icons prefix">search</i>
                      <input type="text" id="search-input">
                    </div>
                  </div>
                </div>
              </div>
          </li>
          <li>
              <a id="github-menu" href="http://github.com/linkedin/rest.li/" >
                   <i class="fa fa-github"></i>
                </a>
          </li>
          </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
</nav>



        <div class="container">
        <div class="row">
                <div class="col s12 m4 l3"> 
               
                    
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Getting Started</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/get_started/quick_start">Quick Start Guide</a></li>
                       
                         <li><a href="/rest.li/start/step_by_step">Step by Step Tutorial</a></li>
                       
                         <li><a href="/rest.li/start/d2_quick_start">Dynamic Discovery</a></li>
                       
                         <li><a href="/rest.li/start/unstructured">Unstructured Data (BLOB)</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Installation</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/setup/building">Building Rest.li from Source</a></li>
                       
                         <li><a href="/rest.li/setup/gradle">Gradle Build Integration</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Presentations</span></li>
                        <ul>
                       
                         <li><a href="https://www.slideshare.net/minchencm/saturn-2018-restli">Rest.li, R2D2, Deco, and ParSeq at Saturn 2018.</a></li>
                       
                        </ul>
                     </ul>
                        
                    </div>
                     <div class="markdown-body col s12 m3 l9">
                            <h1 id="tutorial-to-create-a-restli-server-and-client">Tutorial to Create a Rest.li Server and Client</h1>

<h2 id="contents">Contents</h2>

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#example-source-code--top-level-structure">Example Source Code - Top Level
Structure</a></li>
  <li><a href="#creating-a-server">Creating a Server</a>
    <ul>
      <li><a href="#step-1-define-data-schema">Step 1. Define Data Schema</a></li>
      <li><a href="#step-2-generate-java-bindings">Step 2. Generate Java Bindings</a></li>
      <li><a href="#step-3-implement-restli-server-resource">Step 3. Implement Rest.li Server
Resource</a></li>
      <li><a href="#step-4-build-and-run-the-server">Step 4. Build and Run the
Server</a></li>
    </ul>
  </li>
  <li><a href="#publishing-servers-interface-definition">Publishing Server’s Interface
Definition</a></li>
  <li><a href="#creating-a-client">Creating a Client</a>
    <ul>
      <li><a href="#step-1-generate-client-request-builders">Step 1. Generate Client Request
Builders</a></li>
      <li><a href="#step-2-implement-client-class">Step 2. Implement Client Class</a></li>
      <li><a href="#step-3-build-and-run-the-client">Step 3. Build and Run the
Client</a></li>
    </ul>
  </li>
  <li><a href="#recap">Recap</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>In this tutorial, we’ll take a first look at Rest.li and learn about some of its most basic features. We’ll construct a server that responds with <em>Fortunes</em> for GET requests and also creates a client that sends a request to the server and prints a fortune returned by the server.</p>

<p>Rest.li uses an inversion of control model in which Rest.li defines the
client and server architecture and handles many details of constructing,
receiving, and processing RESTful requests. On the server side, Rest.li
calls your code at the appropriate time to respond to requests. You only
need to worry about your application-specific response to requests. On
the client side, Rest.li helps send type-safe requests to the server and
receives type-safe responses.</p>

<p>To allow Rest.li to perform its tasks, you need to conform to a simple
architecture, in which you define a schema for your data, and classes
that support REST operations on that data. Your classes will designate
handlers for REST operations using Annotations and return objects that
represent your data schema. Rest.li will handle mostly everything else.</p>

<p>We’ll see how Rest.li helps you perform these actions using automatic
code generation, supporting base classes and other infrastructure.</p>

<p><strong>Note</strong>: You will notice references to ‘Pegasus’ in various places as
you work through this tutorial and read other Rest.li documents. Pegasus
is the code name for the project that includes Rest.li and some related
modules. It is also used in some package names.</p>

<h2 id="example-source-code---top-level-structure">Example Source Code - Top Level Structure</h2>

<p>If you like to do things yourself, you should be able to enter the code
in this tutorial into whatever editor you like and construct each step
of the process. You can also follow along using the ready-made source in
the repository under
<a href="https://github.com/linkedin/rest.li/tree/master/examples/quickstart">examples/quickstart</a>
directory. Using the provided source tree frees you from worrying about
the build scripts and directory structure until you want to use Rest.li
in your own projects.</p>

<p>The example can be built using Gradle. Many of the steps involve code
generation that is automated by Gradle plugins provided as part of
Rest.li. We’ll show you the basic build scripts you need for this
example as we go along. For more details about the build process see
<a href="/rest.li/setup/gradle">Gradle Build Integration</a>. You will need
Gradle 1.6+ (run <code class="highlighter-rouge">gradle --version</code> to check). If you have a different
Gradle version and do not want to install the version required by this
example globally, we recommend quickly setting up a <a href="http://www.gradle.org/docs/current/userguide/gradle_wrapper.html">Gradle
wrapper</a>
for this project).</p>

<p>Before we get started, you’ll need to create a basic directory structure
to hold your classes. At the root of the example source tree, you should
have three sub-directories, <code class="highlighter-rouge">api/</code>, <code class="highlighter-rouge">client/</code> and <code class="highlighter-rouge">server/</code>.</p>

<p>You will also need <code class="highlighter-rouge">build.gradle</code> and <code class="highlighter-rouge">settings.gradle</code> files at the top
level.</p>

<p>The <code class="highlighter-rouge">settings.gradle</code> file just includes the sub-projects:</p>

<h5 id="file-example-standalone-appsettingsgradle">file: example-standalone-app/settings.gradle</h5>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">include</span> <span class="s1">'api'</span>
<span class="n">include</span> <span class="s1">'server'</span>
<span class="n">include</span> <span class="s1">'client'</span>
</code></pre></div></div>

<p>The file <code class="highlighter-rouge">build.gradle</code> should contain:</p>

<h5 id="file-example-standalone-appbuildgradle">file: example-standalone-app/build.gradle</h5>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">buildscript</span> <span class="o">{</span>
  <span class="k">repositories</span> <span class="o">{</span>
    <span class="n">mavenLocal</span><span class="o">()</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
    <span class="n">maven</span> <span class="o">{</span>
      <span class="n">url</span> <span class="s2">"https://linkedin.jfrog.io/artifactory/open-source"</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">classpath</span> <span class="s1">'com.linkedin.pegasus:gradle-plugins:29.19.2'</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">wrapper</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Wrapper</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">gradleVersion</span> <span class="o">=</span> <span class="s1">'4.6'</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="n">pegasusVersion</span> <span class="o">=</span> <span class="s1">'29.19.2'</span>
<span class="n">ext</span><span class="o">.</span><span class="na">spec</span> <span class="o">=</span> <span class="o">[</span>
  <span class="s1">'product'</span> <span class="o">:</span> <span class="o">[</span>
    <span class="s1">'pegasus'</span> <span class="o">:</span> <span class="o">[</span>
      <span class="s1">'data'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:data:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'generator'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:generator:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'r2Netty'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:r2-netty:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'restliCommon'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:restli-common:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'restliClient'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:restli-client:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'restliServer'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:restli-server:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'restliTools'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:restli-tools:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'gradlePlugins'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:gradle-plugins:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'restliNettyStandalone'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:restli-netty-standalone:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span><span class="o">,</span>
      <span class="s1">'restliServerStandalone'</span> <span class="o">:</span> <span class="s1">'com.linkedin.pegasus:restli-server-standalone:'</span> <span class="o">+</span> <span class="n">pegasusVersion</span>
    <span class="o">]</span>
  <span class="o">]</span>
<span class="o">]</span>

<span class="k">allprojects</span> <span class="o">{</span>
  <span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'idea'</span>
  <span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'eclipse'</span>
<span class="o">}</span>

<span class="n">ext</span><span class="o">.</span><span class="na">enablePDL</span><span class="o">=</span><span class="kc">true</span>

<span class="k">subprojects</span> <span class="o">{</span>
  <span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'maven'</span>

  <span class="n">afterEvaluate</span> <span class="o">{</span>
    <span class="c1">// add the standard pegasus dependencies wherever the plugin is used</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">hasPlugin</span><span class="o">(</span><span class="s1">'pegasus'</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">dependencies</span> <span class="o">{</span>
        <span class="n">dataTemplateCompile</span> <span class="n">spec</span><span class="o">.</span><span class="na">product</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">data</span>
        <span class="n">restClientCompile</span> <span class="n">spec</span><span class="o">.</span><span class="na">product</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">restliClient</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">repositories</span> <span class="o">{</span>
    <span class="n">mavenLocal</span><span class="o">()</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
    <span class="n">maven</span> <span class="o">{</span>
      <span class="n">url</span> <span class="s2">"https://linkedin.jfrog.io/artifactory/open-source"</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This gradle build file pulls all required jars from a global Maven
repository. It also loads some plugins that facilitate the build process
and various code generation steps. Notice that plugins are also provided
for IntelliJ Idea and Eclipse. For example, executing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gradle idea
</code></pre></div></div>

<p>will generate an Idea project ready to open in Idea. Using Idea or
Eclipse is a handy way to explore and follow along as you read this
tutorial.</p>

<p>Here’s how the structure of your top-level project should look as we
begin:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>example-standalone-app/
+- build.gradle
+- settings.gradle
+- api/
+- client/
+- server/
</code></pre></div></div>

<h2 id="creating-a-server">Creating a Server</h2>

<p>The first thing we will do is implement a very simple server that
responds to GET requests.</p>

<p>The basic steps you will follow to create a Rest.li server are:</p>

<ol>
  <li>
    <p>Define data schema. Rest.li uses <a href="/rest.li/pdl_schema">Pegasus Data Schema</a> to
define the resource data.</p>
  </li>
  <li>
    <p>Generate language bindings. Rest.li will generate java class
bindings for these data schemas to be used in your server and clients.</p>
  </li>
  <li>
    <p>Implement resource classes containing methods to act on your data.
Rest.li provides a set of base classes and annotations that will map
these methods to URIs and REST operations.</p>
  </li>
  <li>
    <p>Create an HTTP server that instantiates a Rest.li server. The
Rest.li server will automatically locate your resource classes and
invoke the appropriate methods when a request is received.</p>
  </li>
</ol>

<p>Rest.li provides tools to make these steps simple, including code
generators that create classes from the data schema, base classes, and
annotations that map entry points in your code to REST operations.</p>

<p>Let’s walk through each step of the process.</p>

<h3 id="step-1-define-data-schema">Step 1. Define Data Schema</h3>

<p>The first step in creating a Rest.li service is to define a data model
or schema for the data that will be returned by your server. We will
define the data model in the <code class="highlighter-rouge">api/</code> directory, which serves to define
the API or interface between the server and clients.</p>

<p>All Rest.li data models are defined in Pegasus Data Schema files, which
have a <code class="highlighter-rouge">.pdl</code> suffix. We’ll define a <code class="highlighter-rouge">Fortune</code> data model in
<code class="highlighter-rouge">Fortune.pdl</code>. The location of this file is important. Be sure to place
it in a path corresponding to your namespace, under
<code class="highlighter-rouge">api/src/main/pegasus/</code>:</p>

<h5 id="file-example-standalone-appapisrcmainpegasuscomexamplefortunefortunepdl">file: example-standalone-app/api/src/main/pegasus/com/example/fortune/Fortune.pdl</h5>

<div class="language-pdl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">namespace</span> <span class="n">com.example.fortune</span><span class="p">

</span><span class="cm">/**
 * Generate a fortune cookie
 */</span><span class="p">
</span><span class="kr">record</span><span class="p"> </span><span class="n">Fortune</span><span class="p"> {

  </span><span class="cm">/**
   * The Fortune cookie string
   */</span><span class="p">
  </span><span class="nl">fortune</span><span class="p">:</span> <span class="kt">string</span><span class="p">
}
</span></code></pre></div></div>

<p><code class="highlighter-rouge">Fortune.pdl</code> defines a record named Fortune, with an associated
namespace. The record has one field, a string whose name is <code class="highlighter-rouge">fortune</code>.
Fields as well as the record itself can have optional documentation
strings. This is, of course, a very simple schema. See
<a href="/rest.li/pdl_schema">Data Schemas</a> for
details on the syntax and more complex examples.</p>

<h3 id="step-2-generate-java-bindings">Step 2. Generate Java Bindings</h3>

<p>Rest.li uses the data model in <code class="highlighter-rouge">.pdl</code> files to generate java versions
of the model that can be used by the server. The easiest way to generate
these classes is to use the Gradle integration provided as part of
Rest.li. You will need a <code class="highlighter-rouge">build.gradle</code> file in the <code class="highlighter-rouge">api/</code> directory
that looks like this:</p>

<h5 id="file-example-standalone-appapibuildgradle">file: example-standalone-app/api/build.gradle</h5>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'pegasus'</span>
</code></pre></div></div>

<p>With <code class="highlighter-rouge">Fortune.pdl</code> and <code class="highlighter-rouge">build.gradle</code> files in place, you can generate
a Java binding for the data model. This Java version is what will
actually be used by your server to return data to calling clients.
Change into the <code class="highlighter-rouge">api/</code> directory and run the following command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gradle build
</code></pre></div></div>

<p>The <code class="highlighter-rouge">pegasus</code> Gradle plugin will detect the presence of <code class="highlighter-rouge">Fortune.pdl</code>
and use the <em>dataTemplateGenerator</em> to generate <code class="highlighter-rouge">Fortune.java</code>. The
generated java classes will be placed under
<code class="highlighter-rouge">api/src/mainGeneratedDataTemplate/</code> directory.</p>

<p>Your file system structure should now look like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>example-standalone-app/
+- build.gradle
+- settings.gradle
+- api/
|  +- build.gradle
|  +- src/
|     +- main/
|     |  +- pegasus/
|     |     +- com/
|     |        +- example/
|     |           +- fortune/
|     |              +- Fortune.pdl
|     +- mainGeneratedDataTemplate/
|        +- java/
|           +- com/
|              +- example/
|                 +- fortune/
|                    +- Fortune.java
+- client/
+- server/
</code></pre></div></div>

<p>The generated java file contains a java representation of the data model
defined in the schema, and includes <code class="highlighter-rouge">get</code> and <code class="highlighter-rouge">set</code> methods for each
element of the model, as well as other supporting methods. You can look
at the generated file to see the full implementation if you are curious;
the following excerpt should give you the general idea. This class is
entirely derived from your data model and should not be
modified.</p>

<h5 id="file-example-standalone-appapisrcmaingenerateddatatemplatejavacomexamplefortunefortunejava">file: example-standalone-app/api/src/mainGeneratedDataTemplate/java/com/example/fortune/Fortune.java</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Generated</span><span class="o">(...)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Fortune</span> <span class="kd">extends</span> <span class="nc">RecordTemplate</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFortune</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getFortune</span><span class="o">(</span><span class="nc">GetMode</span><span class="o">.</span><span class="na">STRICT</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nc">Fortune</span> <span class="nf">setFortune</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">putDirect</span><span class="o">(</span><span class="n">FIELD_Fortune</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="nc">SetMode</span><span class="o">.</span><span class="na">DISALLOW_NULL</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">// ... other methods</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="step-3-implement-restli-server-resource">Step 3. Implement Rest.li Server Resource</h3>

<p>Now that we have defined our data model, the next step is to define a
<code class="highlighter-rouge">resource</code> class that will be invoked by the Rest.li server in
response to requests from clients. We’ll create a class named
<code class="highlighter-rouge">FortunesResource</code>. This class is written by hand, and implements any
REST operations you want to support, returning data using the java data
model class generated in the previous step. The file should be placed
according to your package path under
<code class="highlighter-rouge">server/src/main/java</code>.</p>

<h5 id="file-example-standalone-appserversrcmainjavacomexamplefortuneimplfortunesresourcejava">file: example-standalone-app/server/src/main/java/com/example/fortune/impl/FortunesResource.java</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">fortune</span><span class="o">.</span><span class="na">impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.linkedin.restli.server.annotations.RestLiCollection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.restli.server.resources.CollectionResourceTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.fortune.Fortune</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="cm">/**
 * Simple Rest.li Resource that serves up a fortune cookie.
 */</span>
<span class="nd">@RestLiCollection</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"fortunes"</span><span class="o">,</span> <span class="n">namespace</span> <span class="o">=</span> <span class="s">"com.example.fortune"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FortunesResource</span> <span class="kd">extends</span> <span class="nc">CollectionResourceTemplate</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">Fortune</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="c1">// In-memory store for the fortunes</span>
  <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">fortunes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;();</span>
  <span class="kd">static</span> <span class="o">{</span>
    <span class="n">fortunes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"Today is your lucky day."</span><span class="o">);</span>
    <span class="n">fortunes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">2L</span><span class="o">,</span> <span class="s">"There's no time like the present."</span><span class="o">);</span>
    <span class="n">fortunes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">3L</span><span class="o">,</span> <span class="s">"Don't worry, be happy."</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Fortune</span> <span class="nf">get</span><span class="o">(</span><span class="nc">Long</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Retrieve the requested fortune</span>
    <span class="nc">String</span> <span class="n">fortune</span> <span class="o">=</span> <span class="n">fortunes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">fortune</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">fortune</span> <span class="o">=</span> <span class="s">"Your luck has run out. No fortune for id = "</span> <span class="o">+</span> <span class="n">key</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// return an object that represents the fortune cookie</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Fortune</span><span class="o">().</span><span class="na">setFortune</span><span class="o">(</span><span class="n">fortune</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>FortunesResource extends a Rest.li class, <code class="highlighter-rouge">CollectionResourceTemplate</code>
and, for this simple example, overrides a single method, <code class="highlighter-rouge">get</code>, which
takes a single argument, an id of a resource to be returned. Rest.li
will call this method when it dispatches a GET request to the Fortune
resource. Additional REST operations could be provided by overriding
other methods. See the <a href="/rest.li/user_guide/server_architecture">Rest.li User
Guide</a> for more details about
supporting additional REST methods and other types of resources.</p>

<p>Notice that if this GET were to perform any IO it would be <code class="highlighter-rouge">blocking</code>,
meaning that the thread handling this request will wait for that IO to
complete. Later we will show how we can build async GET methods that
return <a href="https://github.com/linkedin/parseq">ParSeq</a> <code class="highlighter-rouge">Promise</code> and <code class="highlighter-rouge">Task</code> 
classes so that we do not block while performing IO operations.</p>

<p>The <code class="highlighter-rouge">RestLiCollection</code> annotation at the top of the file marks this class as a REST collection, and declares that this resource handles the <code class="highlighter-rouge">/fortunes</code> URI. The result is that calling <code class="highlighter-rouge">http://localhost/fortunes/&lt;id&gt;</code> (assuming your server is running on localhost) will call <code class="highlighter-rouge">FortunesResource.get()</code>, which should return a <code class="highlighter-rouge">Fortune</code> object corresponding to the given fortune identifier. For this simple implementation, we will create a static HashMap that maps several fortune strings to ids. If a requested id is found in the HashMap, we will construct a <code class="highlighter-rouge">Fortune</code> object, set the message and id, and return the object. If the requested id is not found, we’ll return a default message. Rest.li will handle delivering the result to the calling client as a JSON object. (Recall that Fortune.java was generated in a previous step and is found under the <code class="highlighter-rouge">api</code> directory.)</p>

<p>In a real implementation, you would perform whatever steps
are required to retrieve or construct your response to the request. But
ultimately, you will return an instance of your data model class that
represents the data defined in your schema.</p>

<h3 id="step-4-build-and-run-the-server">Step 4. Build and Run the Server</h3>

<p>We’ve now completed the bulk of our application specific server side
code. We’ve defined our data model, and implemented a Resource class
that can respond to a GET request by returning data according to the
model. The only thing remaining is to configure a HTTP framework to call
our application logic. We will use Netty, an excellent framework that
works great with Rest.li to build fully async services. For details on
how to configure Rest.li with other servlet containers see
<a href="/rest.li/Rest_li-with-Servlet-Containers">Rest.li with Servlet Containers</a>.</p>

<p>Rest.li also includes a Request Response layer (R2) that provides a
transport abstraction and other services.</p>

<p>Notice that Rest.li automatically scans all resource classes in the
specified package and initializes the REST endpoints/routes without any
hard-coded connection. Adding additional resources or operations can be
done simply by expanding your data schema and providing additional
functionality in your Resource class(es).</p>

<p>To compile and run the server, we need a <code class="highlighter-rouge">build.gradle</code> file in the
<code class="highlighter-rouge">server/</code> directory, which should look like this:</p>

<h5 id="file-example-standalone-appserverbuildgradle">file: example-standalone-app/server/build.gradle</h5>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'pegasus'</span>

<span class="n">ext</span><span class="o">.</span><span class="na">apiProject</span> <span class="o">=</span> <span class="n">project</span><span class="o">(</span><span class="s1">':api'</span><span class="o">)</span>

<span class="k">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="nl">path:</span> <span class="s1">':api'</span><span class="o">,</span> <span class="nl">configuration:</span> <span class="s1">'dataTemplate'</span><span class="o">)</span>
  <span class="n">compile</span> <span class="n">spec</span><span class="o">.</span><span class="na">product</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">restliServer</span>
  <span class="n">compile</span> <span class="n">spec</span><span class="o">.</span><span class="na">product</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">restliNettyStandalone</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">startFortunesServer</span><span class="o">(</span><span class="nl">type:</span> <span class="n">JavaExec</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">main</span> <span class="o">=</span> <span class="s1">'com.linkedin.restli.server.NettyStandaloneLauncher'</span>
  <span class="n">args</span> <span class="o">=</span> <span class="o">[</span><span class="s1">'-port'</span><span class="o">,</span> <span class="s1">'8080'</span><span class="o">,</span> <span class="s1">'-packages'</span><span class="o">,</span> <span class="s1">'com.example.fortune.impl'</span><span class="o">]</span>
  <span class="n">classpath</span> <span class="o">=</span> <span class="k">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">runtimeClasspath</span>
  <span class="n">standardInput</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">in</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Next, create a <code class="highlighter-rouge">gradle.properties</code> file containing the following line:</p>

<h5 id="file-example-standalone-appservergradleproperties">file: example-standalone-app/server/gradle.properties</h5>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rest</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">compatibility</span><span class="o">=</span><span class="n">ignore</span>
</code></pre></div></div>

<p>This disables some <a href="/rest.li/setup/gradle#compatibility">compatibility checks</a> on the generated files. You will need these checks in a real project but to keep this example simple we are disabling these checks.</p>

<p>With these files in place, your server directory structure should look
like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>example-standalone-app/
+- build.gradle
+- settings.gradle
+- api/
|  ...
+- client/
+- server/
   +- build.gradle
   +- gradle.properties
   +- src/
      +- main/
         +- java/
            +- com/
               +- example/
                  +- fortune/
                     +- impl/
                       +- FortuneResource.java
</code></pre></div></div>

<p>Now you can build the server from the <code class="highlighter-rouge">server/</code> directory with:
    $ gradle build</p>

<p><strong>Note:</strong> If prompted, run the build command a second time. The first build
runs a bootstrapping code generation process, requiring a second build
to compile the generated code.</p>

<p>After building the server, you can launch the server using the following
command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gradle startFortunesServer
</code></pre></div></div>

<p>Once the server is running, you can perform tests using <code class="highlighter-rouge">curl</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -v http://localhost:8080/fortunes/1

* About to connect() to localhost port 8080 (#0)
*   Trying ::1... connected
* Connected to localhost (::1) port 8080 (#0)
&gt; GET /fortunes/1 HTTP/1.1
&gt; User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.12.9.0 zlib/1.2.3 libidn/1.18 libssh2/1.2.2
&gt; Host: localhost:8080
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; X-LinkedIn-Type: com.example.fortune.Fortune
&lt; Content-Type: application/json
&lt; Content-Length: 45
&lt; Server: Jetty(6.1.26)
&lt; 
* Connection #0 to host localhost left intact
* Closing connection #0
{"id":1,"fortune":"Today is your lucky day."}[
</code></pre></div></div>

<p>Here, <code class="highlighter-rouge">curl</code> issued a GET request for <code class="highlighter-rouge">/fortunes/1</code>. Rest.li routed the
request to the <code class="highlighter-rouge">FortunesResource</code>, which interpreted the argument <code class="highlighter-rouge">1</code>,
found the corresponding string, and constructed a <code class="highlighter-rouge">Fortune</code> object to
return. Rest.li automatically transforms the java data model to JSON and
returns the result to the caller.</p>

<h2 id="publishing-servers-interface-definition">Publishing Server’s Interface Definition</h2>

<p>Before we move on to look at the Rest.li’s client support, notice that
the process of building the server generated an additional file. If you
look at your directory structure, you should see an IDL file under
<code class="highlighter-rouge">server/src/mainGeneratedRest/idl/</code>. The file is in JSON format and
defines the interface supported by the server. The interface is
generated as a result of the annotations in the Resource class, in this
example, <code class="highlighter-rouge">FortunesResource.java</code>. However if for some reason the file is
not available in your filesystem you can generate it by issuing the
following command</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd server
$ gradle publishRestliIdl
</code></pre></div></div>

<p>The <code class="highlighter-rouge">publishRestliIdl</code> task will first run the <code class="highlighter-rouge">generateRestModel</code> which
creates
<code class="highlighter-rouge">server/src/mainGeneratedRest/idl/com.example.fortune.fortunes.restspec.json</code>.
It will then copy this file into the <code class="highlighter-rouge">api</code> module at
<code class="highlighter-rouge">api/src/main/idl/com.example.fortune.fortunes.restspec.json</code>.</p>

<p>You may also notice a <code class="highlighter-rouge">snapshot/</code> directory next to the <code class="highlighter-rouge">idl/</code>
directory. This is used by the compatibility checker to keep track of
changes. You can ignore that for now.</p>

<p>Here is the generated IDL file. Notice that all of this information was
derived from server’s <code class="highlighter-rouge">FortunesResource.java</code> including the
documentation
strings.</p>

<h5 id="file-example-standalone-appserversrcmaingeneratedrestidlcomexamplefortunefortunesrestspecjson">file: example-standalone-app/server/src/mainGeneratedRest/idl/com.example.fortune.fortunes.restspec.json</h5>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fortune"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"namespace"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"com.example.fortune"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/fortunes"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"schema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"com.linkedin.restli.example.Fortune"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"doc"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Simple Rest.li Resource that serves up a fortune cookie.</span><span class="se">\n\n</span><span class="s2">generated from: com.example.fortune.impl.FortunesResource"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"collection"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"identifier"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fortuneId"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"supports"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"get"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"methods"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"method"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"get"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"entity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"path"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/fortunes/{fortuneId}"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This file represents the contract between the server and the client.
Accordingly, the build also copied the IDL to the <code class="highlighter-rouge">api</code> module, where it
can be accessed by the client code.</p>

<p>Just to verify that everything is in place, this is how your project’s
<code class="highlighter-rouge">api/</code> and <code class="highlighter-rouge">server/</code> directories should look at this point:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>example-standalone-app/
+- build.gradle
+- settings.gradle
+- api/
|  +- build.gradle
|  +- src/
|     +- main/
|     |  +- idl/
|     |  |  +- com.example.fortune.fortunes.restspec.json
|     |  +- pegasus/
|     |  |  +- com/
|     |  |     +- example/
|     |  |        +- fortune/
|     |  |           +- Fortune.pdl
|     |  +- snapshot/
|     |     +- com.example.fortune.fortunes.snapshot.json
|     +- mainGeneratedDataTemplate/
|        +- java/
|           +- com/
|              +- example/
|                 +- fortune/
|                    +- Fortune.java
+- client/
+- server/
   +- build.gradle
   +- gradle.properties
   +- src/
      +- main/
      |  +- java/
      |     +- com/
      |        +- example/
      |           +- fortune/
      |              +- impl/
      |                +- FortuneResource.java
      +- mainGeneratedRest/
         +- idl/
         |  +- com.example.fortune.fortunes.restspec.json
         +- snapshot/
            +- com.example.fortune.fortunes.snapshot.json
</code></pre></div></div>

<h2 id="creating-a-client">Creating a Client</h2>

<p>Now that we have a server implemented and tested with curl, let’s see
how we can use Rest.li to help build a client.</p>

<h3 id="step-1-generate-client-request-builders">Step 1. Generate Client Request Builders</h3>

<p>Rest.li uses the IDL published by the server to generate client classes
that can be used to construct requests. The <code class="highlighter-rouge">pegasus</code> Gradle plugin
provides tools to generate these classes. Let’s start by creating a
<code class="highlighter-rouge">build.gradle</code> file in the <code class="highlighter-rouge">client/</code> directory:</p>

<h5 id="file-examples-standalone-appclientbuildgradle">file: examples-standalone-app/client/build.gradle</h5>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'java'</span>

<span class="k">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span> <span class="nf">project</span><span class="o">(</span><span class="nl">path:</span> <span class="s1">':api'</span><span class="o">,</span> <span class="nl">configuration:</span> <span class="s1">'restClient'</span><span class="o">)</span>
  <span class="n">compile</span> <span class="n">spec</span><span class="o">.</span><span class="na">product</span><span class="o">.</span><span class="na">pegasus</span><span class="o">.</span><span class="na">r2Netty</span>
<span class="o">}</span>

<span class="n">task</span> <span class="nf">startFortunesClient</span><span class="o">(</span><span class="nl">type:</span> <span class="n">JavaExec</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">main</span> <span class="o">=</span> <span class="s1">'com.example.fortune.RestLiFortunesClient'</span>
  <span class="n">classpath</span> <span class="o">=</span> <span class="k">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">runtimeClasspath</span>
<span class="o">}</span>
</code></pre></div></div>

<p>To generate the interface classes used by the client, change to the
<code class="highlighter-rouge">client/</code> directory and type the command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gradle build
</code></pre></div></div>

<p>Building in the client directory generates java classes that represent
the resources and operations on those resources supported by the server.
These are basically convenience classes that help you <em>build</em> requests
from the client side. In this example, you should see some new java
files, including <code class="highlighter-rouge">FortunesRequestBuilders.java</code> and
<code class="highlighter-rouge">FortunesGetRequestBuilder.java</code>. These files are placed in the <code class="highlighter-rouge">api/</code>
module where they can be shared among multiple clients.
<code class="highlighter-rouge">FortunesRequestBuilders</code> is a factory class that instantiates any
request builders you may need. In this example, our server resource only
supports GET requests, so the process has just generated a
<code class="highlighter-rouge">FortunesGetRequestBuilder</code> class. You can look at the generated source
code under the <code class="highlighter-rouge">api/src/mainGeneratedRest/</code> directory, if you’re
interested, but for this tutorial, let’s just go on to creating a client
and see how a builder is used.</p>

<p><strong>Note:</strong> You may also see two additional files: <code class="highlighter-rouge">FortuneBuilders.java</code>
and <code class="highlighter-rouge">FortunesGetBuilder.java</code>. These are deprecated interfaces that were
used prior to Rest.li v1.24.4. If you are just getting started with
Rest.li and using the latest version you can ignore these files.</p>

<h3 id="step-2-implement-client-class">Step 2. Implement Client Class</h3>

<p>Creating a client involves using a few classes to handle connecting to
the server, and using the Builder classes generated in the previous step
to construct requests. Let’s see how that works before we look at the
actual client code.</p>

<p>The following lines of code instantiate a <code class="highlighter-rouge">FortunesRequestBuilders</code>
factory, and then call its <code class="highlighter-rouge">get()</code> method to create a
<code class="highlighter-rouge">FortunesGetRequestBuilder</code> object. Finally, the
<code class="highlighter-rouge">FortunesGetRequestBuilder</code> instance lets you supply the information
that needs to be passed in the request and builds a <code class="highlighter-rouge">Request</code> object:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">FortunesRequestBuilders</span> <span class="n">fortunesBuilders</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FortunesRequestBuilders</span><span class="o">();</span>
<span class="nc">FortunesGetRequestBuilder</span> <span class="n">getBuilder</span> <span class="o">=</span> <span class="n">fortunesBuilders</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="nc">Request</span><span class="o">&lt;</span><span class="nc">Fortune</span><span class="o">&gt;</span> <span class="n">getRequest</span> <span class="o">=</span> <span class="n">getBuilder</span><span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">fortuneId</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>

<p>The process of sending a request from a client basically consists of
creating a <code class="highlighter-rouge">RestClient</code> object and invoking its <code class="highlighter-rouge">sendRequest()</code> method
to send the request to the
    server:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">RestClient</span> <span class="n">restClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RestClient</span><span class="o">(</span><span class="n">r2Client</span><span class="o">,</span> <span class="s">"http://localhost:8080/"</span><span class="o">);</span>
<span class="nc">ResponseFuture</span><span class="o">&lt;</span><span class="nc">Fortune</span><span class="o">&gt;</span> <span class="n">getFuture</span> <span class="o">=</span> <span class="n">restClient</span><span class="o">.</span><span class="na">sendRequest</span><span class="o">(</span><span class="n">getRequest</span><span class="o">);</span>
<span class="nc">Response</span><span class="o">&lt;</span><span class="nc">Fortune</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">getFuture</span><span class="o">.</span><span class="na">getResponse</span><span class="o">();</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">RestClient.sendRequest()</code> returns a <code class="highlighter-rouge">Future</code>, which can be used to wait
on and retrieve the response from the server. Note that the response is
type-safe, and parametrized as type Fortune, so we can use the <code class="highlighter-rouge">Fortune</code>
interface to retrieve the results, like
    this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getFortune</span><span class="o">();</span>
<span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getId</span><span class="o">();</span>
</code></pre></div></div>

<p>Here is a completed <code class="highlighter-rouge">RestLiFortunesClient</code> class, which uses the R2
library to create the transport mechanisms. For this example, the client
will just generate a random ID between 0 and 5, and print the response.
This file should go under <code class="highlighter-rouge">client/src/main/java/</code> directory with the
appropriate java package
structure.</p>

<h5 id="file-example-standalone-appclientsrcmainjavacomexamplefortunerestlifortunesclientjava">file: example-standalone-app/client/src/main/java/com/example/fortune/RestLiFortunesClient.java</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">fortune</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.linkedin.common.callback.FutureCallback</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.common.util.None</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.r2.transport.common.Client</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.r2.transport.common.bridge.client.TransportClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.r2.transport.common.bridge.client.TransportClientAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.r2.transport.http.client.HttpClientFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.restli.client.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.restli.client.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.restli.client.ResponseFuture</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.linkedin.restli.client.RestClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.fortune.FortunesRequestBuilders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RestLiFortunesClient</span> <span class="o">{</span>
  <span class="cm">/**
   * This stand-alone app demos the client-side Rest.li API.
   * To see the demo, run the server, then start the client
   */</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

    <span class="c1">// Create an HttpClient and wrap it in an abstraction layer</span>
    <span class="kd">final</span> <span class="nc">HttpClientFactory</span> <span class="n">http</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpClientFactory</span><span class="o">();</span>
    <span class="kd">final</span> <span class="nc">Client</span> <span class="n">r2Client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TransportClientAdapter</span><span class="o">(</span>
        <span class="n">http</span><span class="o">.</span><span class="na">getClient</span><span class="o">(</span><span class="nc">Collections</span><span class="o">.&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span><span class="n">emptyMap</span><span class="o">()));</span>

    <span class="c1">// Create a RestClient to talk to localhost:8080</span>
    <span class="nc">RestClient</span> <span class="n">restClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RestClient</span><span class="o">(</span><span class="n">r2Client</span><span class="o">,</span> <span class="s">"http://localhost:8080/"</span><span class="o">);</span>

    <span class="c1">// Generate a random ID for a fortune cookie, in the range 0 - 5</span>
    <span class="kt">long</span> <span class="n">fortuneId</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">5</span><span class="o">);</span>

    <span class="c1">// Construct a request for the specified fortune</span>
    <span class="nc">FortunesGetRequestBuilder</span> <span class="n">getBuilder</span> <span class="o">=</span> <span class="n">fortuneBuilders</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="nc">Request</span><span class="o">&lt;</span><span class="nc">Fortune</span><span class="o">&gt;</span> <span class="n">getRequest</span> <span class="o">=</span> <span class="n">getBuilder</span><span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">fortuneId</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="c1">// Send the request and wait for a response</span>
    <span class="kd">final</span> <span class="nc">ResponseFuture</span><span class="o">&lt;</span><span class="nc">Fortune</span><span class="o">&gt;</span> <span class="n">getFuture</span> <span class="o">=</span> <span class="n">restClient</span><span class="o">.</span><span class="na">sendRequest</span><span class="o">(</span><span class="n">getRequest</span><span class="o">);</span>
    <span class="kd">final</span> <span class="nc">Response</span><span class="o">&lt;</span><span class="nc">Fortune</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">getFuture</span><span class="o">.</span><span class="na">getResponse</span><span class="o">();</span>

    <span class="c1">// Print the response</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">().</span><span class="na">getFortune</span><span class="o">());</span>

    <span class="c1">// Shutdown</span>
    <span class="n">restClient</span><span class="o">.</span><span class="na">shutdown</span><span class="o">(</span><span class="k">new</span> <span class="nc">FutureCallback</span><span class="o">&lt;</span><span class="nc">None</span><span class="o">&gt;());</span>
    <span class="n">http</span><span class="o">.</span><span class="na">shutdown</span><span class="o">(</span><span class="k">new</span> <span class="nc">FutureCallback</span><span class="o">&lt;</span><span class="nc">None</span><span class="o">&gt;());</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">FortunesRequestBuilders</span> <span class="n">fortuneBuilders</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FortunesRequestBuilders</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="step-3-build-and-run-the-client">Step 3. Build and Run the Client</h3>

<p>With your client code in place, your directory structure should look
like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>example-standalone-app/
+- build.gradle
+- settings.gradle
+- api/
|  ...
+- client/
|  +- build.gradle
|  +- src/
|     +- main/
|        +- java/
|           +- com/
|              +- example/
|                 +- fortune/
|                      +- RestLiFortunesClient.java
+- server/
   ...
</code></pre></div></div>

<p>Build the client by building in the client directory:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gradle build
</code></pre></div></div>

<p>To test our final client/server pair, start the server in one terminal
window:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gradle startFortunesServer
</code></pre></div></div>

<p>Then in another window, run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gradle startFortunesClient
</code></pre></div></div>

<p>You should see a “fortune cookie” printed out from the client before it
exits.</p>

<p>If you want to inspect the request being sent by the client, stop the
server, and run <code class="highlighter-rouge">netcat</code> or a similar packet sniffer tool to listen on
port 8080, and then run the client:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ netcat -l -p 8080

GET /fortunes/1 HTTP/1.1
Host: localhost:8080
X-LI-R2-W-MsgType: REST
Content-Length: 0
</code></pre></div></div>

<h2 id="recap">Recap</h2>

<p>We’ve now completed a quick tour of a few of the most basic features of
Rest.li. Let’s review the steps we took to create a server and a
corresponding client:</p>

<ol>
  <li>Define a data model (<code class="highlighter-rouge">Fortune.pdl</code>)</li>
  <li>Generate Java language bindings (<code class="highlighter-rouge">Fortune.java RecordTemplate class</code>)</li>
  <li>Create a Resource that responds to REST requests
(<code class="highlighter-rouge">FortuneResource.java</code>) by subclassing <code class="highlighter-rouge">CollectionResourceTemplate</code>
and using <code class="highlighter-rouge">RestLiAnnotations</code> to define operations and entry points</li>
  <li>Create a server that locates our Resource classes and uses Netty to
dispatch requests</li>
  <li>Generate IDL (<code class="highlighter-rouge">fortune.restpec.json</code>) and Java client request builders
from the server Resource file (<code class="highlighter-rouge">FortunesRequestBuilders.java</code> and
<code class="highlighter-rouge">FortunesGetRequestBuilder.java</code>)</li>
  <li>Create a client that uses the <code class="highlighter-rouge">RestClient</code> to send requests
constructed by calling the builder classes
(<code class="highlighter-rouge">RestLiFortuneClient.java</code>)</li>
</ol>

<p>Notice that (ignoring Gradle build files) there are only three files in
this example that you had to create:</p>

<ul>
  <li>The original Pegasus Data Model file (<code class="highlighter-rouge">Fortune.pdl</code>)</li>
  <li>The server resource file (<code class="highlighter-rouge">FortunesResource.java</code>)</li>
  <li>The client (<code class="highlighter-rouge">RestLiFortuneClient.java</code>)</li>
</ul>

<p>Although Rest.li has many more features that can be leveraged when
creating the server and client, most of your focus will usually be on
defining data models and implementing resource classes that provide
and/or manipulate the data.</p>

<p>To learn more about Rest.li, proceed to the more complex examples in the source code and read the <a href="/rest.li/user_guide/server_architecture">Rest.li User’s Guide</a>.</p>

                     </div>
                     <!-- <div class="col l3">
                            <div class="row">
                                    <div class="col l12">
                                      <div class="card blue-grey darken-1">
                                        <div class="card-content white-text">
                                          <span class="card-title">Card Title</span>
                                          <p>I am a very simple card. I am good at containing small bits of information.
                                          I am convenient because I require little markup to use effectively.</p>
                                        </div>
                                        <div class="card-action">
                                          <a href="#">This is a link</a>
                                          <a href="#">This is a link</a>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                     </div> -->
                   </div>
</div>



      <footer class="page-footer">
    <div class="container">
      <div class="row">
        <div class="col s6">
          <h5>Rest.li</h5>
          <p class="text-lighten-4">Rest.li is an open source REST framework for building robust, scalable RESTful architectures using type-safe bindings and asynchronous, non-blocking IO. Rest.li fills a niche for applying RESTful principles at scale with an end-to-end developer workflow for building REST APIs, which promotes clean REST practices, uniform interface design and consistent data modeling.</p>
        </div>
        <div class="col s5 offset-s1">
          <h5 class="black-text">Community</h5>
          <ul>
              <li>GitHub <a class="" href="https://github.com/linkedin/rest.li">Rest.li</a></li>
              <li>LinkedIn <a class="" href="https://www.linkedin.com/groups/4855943/">Rest.li Group</a></li>
            <li>Follow us on twitter: <a class="" href="https://twitter.com/rest_li"> @rest_li</a></li>
            <li>Issue Tracking: <a class="" href="https://github.com/linkedin/rest.li/issues">GitHub issue tracking</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
        <div class="container">
            <div class="row">
              <div class="col s6">
                      Copyright 2018 LinkedIn Corporation </br>
                      This work is licensed under a <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.  </br>
                      For clarity, no trademark is licensed.
                      </br></br>
              </div>
              <div class="col s5 offset-s1">
                      This work was made by using Jekyll (and a Jekyll Starter Template)</br>
                      <a target="_blank" href="https://github.com/macrod68/jekyll-materialize-starter-template">https://github.com/macrod68/jekyll-materialize-starter-template</a></br>
                      Copyright © 2017 Marco Damiani. Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a></br>
                      License:<a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a>
              </div>
            </div>
        </div>
    </div>
    <script>
      $(function() {
        return $("h2, h3, h4, h5, h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
      </script>
</footer>

      
    <!--  Scripts-->                                                                               
<script src="/rest.li/assets/js/jquery.min.js"></script>
<script src="/rest.li/assets/js/materialize.min.js"></script>
<script src="/rest.li/assets/js/init.js"></script>

  </body>

</html>
