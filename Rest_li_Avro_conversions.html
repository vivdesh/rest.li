<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128576866-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-128576866-1');
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>

    <title>Rest.li to Avro conversions</title>
    <meta name="description" content="Sometimes it is necessary to convert between Avro and Rest.li formats. That is, either converting schemas or converting data. Rest.li provides ways to do thi..." />

    <link rel="icon" type="image/png" href="/rest.li/assets/images/icon_pegasus.png">
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen,projection" href="/rest.li/assets/css/main.css">
    <link rel="canonical" href="/rest.li/Rest_li_Avro_conversions" />
    <link rel="alternate" type="application/rss+xml" title="rest.li" href="/rest.li/feed.xml" />

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <script src="//code.jquery.com/jquery-3.0.0.min.js"></script>
    <script src="/rest.li/assets/js/search-input.js"></script>
    

    
    <script>
       $(function() {
          $("h1").addClass("no_toc");
       });
    </script>
</head>


  <body>

    <nav class="dark-grey" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" class="brand-logo" href="/rest.li/">Rest.li</a>
      <ul class="right hide-on-med-and-down">
        
        <li>
          <a href="/rest.li/get_started/quick_start" >
            Getting Started
          </a>
        </li>
        
        <li>
          <a href="/rest.li/user_guide/server_architecture" >
            User Guide
          </a>
        </li>
        
        <li>
          <a href="/rest.li/spec/protocol" >
            API Reference
          </a>
        </li>
        
        <li>
          <a href="/rest.li/contribute/howto" >
            Contribute
          </a>
        </li>
        
          <li>
            <div class="center row" >
              <div class="col s12 ">
                <div class="row">
                  <div class="input-field col s6 s12 min">
                      <i id="search-txt" class="material-icons prefix">search</i>
                      <input type="text" id="search-input">
                    </div>
                  </div>
                </div>
              </div>
          </li>
          <li>
              <a id="github-menu" href="http://github.com/linkedin/rest.li/" >
                   <i class="fa fa-github"></i>
                </a>
          </li>
          </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
</nav>



        <div class="container">
        <div class="row">
                <div class="col s12 m4 l3"> 
               
                    
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">User Guide</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/user_guide/server_architecture">Rest.li Architecture</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_server">Rest.li Server</a></li>
                       
                         <li><a href="/rest.li/user_guide/restli_client">Rest.li Client Framework</a></li>
                       
                         <li><a href="/rest.li/user_guide/unstructured_data">Unstructured Data</a></li>
                       
                         <li><a href="/rest.li/Components">Components</a></li>
                       
                         <li><a href="/rest.li/Asynchronous-Servers-and-Clients-in-Rest_li">Asynchronous in Rest.li</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Data Schemas</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/pdl_schema">PDL Schema</a></li>
                       
                         <li><a href="/rest.li/pdsc_syntax">PDSC Syntax</a></li>
                       
                         <li><a href="/rest.li/pdl_migration">Migrating from PDSC to PDL</a></li>
                       
                         <li><a href="/rest.li/avro_translation">Avro Translation</a></li>
                       
                         <li><a href="/rest.li/java_binding">Java Binding</a></li>
                       
                         <li><a href="/rest.li/annotation_processor">Schema Annotation Processor</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Modeling Resources</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/modeling/modeling">Modeling Resources</a></li>
                       
                         <li><a href="/rest.li/modeling/compatibility_check">Snapshots and Resource Compatibility Checking</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Data</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/how_data_is_serialized_for_transport">How Data is Serialized for Transport</a></li>
                       
                         <li><a href="/rest.li/how_data_is_represented_in_memory">How Data is Represented in Memory</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Main concepts</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Rest_li-Filters">Filters</a></li>
                       
                         <li><a href="/rest.li/Projections">Projections</a></li>
                       
                         <li><a href="/rest.li/pathspec">PathSpecs</a></li>
                       
                         <li><a href="/rest.li/Validation-in-Rest_li">Validation</a></li>
                       
                         <li><a href="/rest.li/Attachment-Streaming">Attachment Streaming</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Mutli-language</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/multi_language_compatibility_matrix">Compatibility Matrix</a></li>
                       
                         <li><a href="/rest.li/test_suite">Test Suite</a></li>
                       
                         <li><a href="https://github.com/mchen07/restli-csharp">C#</a></li>
                       
                         <li><a href="/rest.li/Scala-Integration">Scala Integration</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">Testing</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Writing-unit-tests-for-Rest_li-clients-and-servers">Writing Unit Tests</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">How to</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Send-Rest_li-Request-Query-In-Request-Body">Send Request Query in the Body</a></li>
                       
                         <li><a href="/rest.li/How-to-use-projections-in-Java">Use Projections</a></li>
                       
                         <li><a href="/rest.li/Rest_li_Avro_conversions">Avro Conversion</a></li>
                       
                         <li><a href="/rest.li/Compression">Compression</a></li>
                       
                         <li><a href="/rest.li/Rest_li-2_x-upgrade-instructions">Migrate to Rest.li 2.x</a></li>
                       
                         <li><a href="/rest.li/testsuite_how_to">Test Suite</a></li>
                       
                         <li><a href="/rest.li/howto_add_new_language">Test Suite - Add New Language</a></li>
                       
                         <li><a href="/rest.li/user_guide/service_errors_java">Configure Service Errors in Java</a></li>
                       
                        </ul>
                     </ul>
                        
                   
                    
                     <ul class="nav_items">
                        <li><span class="nav_sub-title">FAQ</span></li>
                        <ul>
                       
                         <li><a href="/rest.li/Data-FAQ">Rest.li - FAQ</a></li>
                       
                         <li><a href="/rest.li/testsuite_troubleshooting">Test Suite - Troubleshooting</a></li>
                       
                        </ul>
                     </ul>
                        
                    </div>
                     <div class="markdown-body col s12 m3 l9">
                            <h1 id="restli-to-avro-conversions">Rest.li to Avro Conversions</h1>

<h2 id="contents">Contents</h2>
<ul>
  <li><a href="#converting-schemas">Converting Schemas</a></li>
  <li><a href="#converting-data">Converting Data</a></li>
  <li><a href="#faq">FAQ</a></li>
</ul>

<p>Sometimes it is necessary to convert between Avro and Rest.li formats. That is, either converting schemas (Rest.li <code class="highlighter-rouge">DataSchema</code>s to Avro <code class="highlighter-rouge">Schema</code>s and vice versa) or converting data (Rest.li <code class="highlighter-rouge">DataMap</code>s to Avro <code class="highlighter-rouge">GenericRecord</code>s and vice versa). Rest.li provides ways to do this using the data-avro module.</p>

<h2 id="converting-schemas">Converting Schemas</h2>
<p>The key class for converting schemas is the <code class="highlighter-rouge">SchemaTranslator</code> class.</p>
<h3 id="converting-avro-to-restli">Converting Avro to Rest.li</h3>
<p>To convert from Avro to Rest.li, you will use the <code class="highlighter-rouge">avroToDataSchema</code> methods in SchemaTranslator.
The default method takes in only the Avro schema you wish to convert as input:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">avro</span><span class="o">.</span><span class="na">SchemaTranslator</span><span class="o">.</span><span class="na">avroToDataSchema</span><span class="o">(</span><span class="n">avroSchema</span><span class="o">);</span>
</code></pre></div></div>
<p>This schema can either be a stringified version of the Schema or an <code class="highlighter-rouge">org.apache.avro.Schema</code>.</p>

<p>There is also a similar method that also accepts an <code class="highlighter-rouge">AvroToDataSchemaTranslationMode</code>.  Generally, this method doesn’t need to be used.  However, if you have embedded your rest.li schema within your Avro schema, and you can use this with the <code class="highlighter-rouge">AvroToDataSchemaTranslationMode</code> to speed up the translation process. This is normally done when translating from Rest.li format to Avro format.  See the section for converting from Rest.li to Avro to learn more about this.</p>

<h3 id="converting-restli-to-avro">Converting Rest.li to Avro</h3>
<p>To convert from Rest.li to Avro, you will use the <code class="highlighter-rouge">dataToAvroSchema</code> methods in SchemaTranslator. Like the <code class="highlighter-rouge">avroToDataSchema</code> method, it can take in either a stringified restli schema, or a  <code class="highlighter-rouge">DataSchema</code>, and, optionally, a <code class="highlighter-rouge">DataToAvroSchemaTranslationOptions</code></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">avro</span><span class="o">.</span><span class="na">SchemaTranslator</span><span class="o">.</span><span class="na">dataToAvroSchema</span><span class="o">(</span><span class="n">dataSchema</span><span class="o">);</span>
<span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">avro</span><span class="o">.</span><span class="na">SchemaTranslator</span><span class="o">.</span><span class="na">dataToAvroSchema</span><span class="o">(</span><span class="n">dataSchema</span><span class="o">,</span> <span class="n">translationOptions</span><span class="o">);</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">DataToAvroSchemaTranslationOptions</code> has four parts:</p>
<ul>
  <li>The translation mode <code class="highlighter-rouge">OptionalDefaultMode</code></li>
  <li>The JSON style <code class="highlighter-rouge">JsonBuilder.Pretty</code></li>
  <li>The schema embedding mode <code class="highlighter-rouge">EmbedSchemaMode</code></li>
  <li>The namespace override flag <code class="highlighter-rouge">overrideNamespace</code></li>
</ul>

<p><code class="highlighter-rouge">OptionalDefaultMode</code> determines how defaults are translated into Rest.li format.  Since Avro requires that a union’s default value always be of the same type as the first member type of the union, if a type is not consistently initialized with a single default type, translations may encounter problems.  By default this value is set to <code class="highlighter-rouge">TRANSLATE_DEFAULT</code>, but if your translations are encountering issues around default values, you may wish to set this to <code class="highlighter-rouge">TRANSLATE_TO_NULL</code>, which will cause all optional fields with a default value to have their default value set to null in the Avro translation.</p>

<p><code class="highlighter-rouge">JsonBuilder.Pretty</code> simply sets the format of the output JSON.  By default, this is set to <code class="highlighter-rouge">COMPACT</code>.</p>

<p><code class="highlighter-rouge">EmbedSchemaMode</code> determines whether or not to embed the original Rest.li schema into the resulting Avro schema.  This can speed translation back (or make a translation back more accurate) to Rest.li format with the correct settings passed to the <code class="highlighter-rouge">avroToDataSchema</code> method. By default, this is set to <code class="highlighter-rouge">NONE</code>.</p>

<p><code class="highlighter-rouge">overrideNamespace</code> is a boolean flag indicating whether the namespaces of the translated Avro schemas should be overridden. If this flag is set to <code class="highlighter-rouge">true</code>, then the namespace of each translated Avro schema will be prepended with a special prefix,
<code class="highlighter-rouge">"avro."</code> (e.g. <code class="highlighter-rouge">com.x.y</code> becomes <code class="highlighter-rouge">avro.com.x.y</code>). This is helpful in cases where pegasus schemas and their Avro counterparts are included in the same project, potentially causing namespace/package conflicts.</p>

<h2 id="converting-data">Converting Data</h2>
<p>The key class for converting data is the <code class="highlighter-rouge">DataTranslator</code> class.</p>
<h3 id="converting-avro-to-restli-1">Converting Avro to Rest.li</h3>
<p>To convert from Avro to Rest.li, you will use the <code class="highlighter-rouge">genericRecordToDataMap</code> method in <code class="highlighter-rouge">DataTranslator</code>. You’ll need the Avro <code class="highlighter-rouge">GenericRecord</code> you are converting, the Avro <code class="highlighter-rouge">Schema</code> the <code class="highlighter-rouge">GenericRecord</code> conforms to, and the Rest.li <code class="highlighter-rouge">RecordDataSchema</code> of the Rest.li type you are converting to:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">avro</span><span class="o">.</span><span class="na">DataTranslator</span><span class="o">.</span><span class="na">genericRecordToDataMap</span><span class="o">(</span><span class="n">genericRecord</span><span class="o">,</span> <span class="n">recordDataSchema</span><span class="o">,</span> <span class="n">avroSchema</span><span class="o">);</span>
</code></pre></div></div>
<p>There are no versions of this method that accept any special options.</p>

<h3 id="converting-restli-to-avro-1">Converting Rest.li to Avro</h3>
<p>To convert from Rest.li to Avro, you will use the <code class="highlighter-rouge">dataMapToGenericRecord</code> methods in <code class="highlighter-rouge">DataTranslator</code>.  You will need the Rest.li <code class="highlighter-rouge">DataMap</code> you are converting, the <code class="highlighter-rouge">RecordDataTemplate</code> your <code class="highlighter-rouge">DataMap</code> conforms to, and, optionally, the Avro <code class="highlighter-rouge">Schema</code> you are converting your data to. If you do not pass in an Avro <code class="highlighter-rouge">Schema</code>, then the schema translator will be used to convert your passed in <code class="highlighter-rouge">RecordDataSchema</code> to an Avro <code class="highlighter-rouge">Schema</code>, using default settings.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">avro</span><span class="o">.</span><span class="na">DataTranslator</span><span class="o">(</span><span class="n">dataMap</span><span class="o">,</span> <span class="n">dataSchema</span><span class="o">);</span>
<span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">avro</span><span class="o">.</span><span class="na">DataTranslator</span><span class="o">(</span><span class="n">dataMap</span><span class="o">,</span> <span class="n">dataSchema</span><span class="o">,</span> <span class="n">avroSchema</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="automatically-generating-avro-schemas-as-part-of-a-build">Automatically generating avro schemas as part of a build</h3>

<p>Rest.li will generate avro schemas for all your pegasus schemas (<code class="highlighter-rouge">.pdl</code> files) automatically if the build is configured to enable this.</p>

<p>See <a href="setup/gradle#generateavroschema">Gradle generateAvroSchema Task</a> for details on how to enable.</p>

<h2 id="faq">FAQ</h2>
<h3 id="how-do-i-get-the-recorddataschema-of-a-particular-record-type">How do I get the RecordDataSchema of a particular Record type?</h3>
<p>The RecordDataSchema field of generated Record classes are private, so you cannot get them directly.  However, there is a helper method in <code class="highlighter-rouge">com.linkedin.data.template.DataTemplateUtil</code> called <code class="highlighter-rouge">getSchema</code> that can help you get the Schema.  Simply pass in the class of the Record and it will return a basic <code class="highlighter-rouge">DataSchema</code>.  If you know this Schema is a <code class="highlighter-rouge">RecordDataSchema</code>, you can safely cast the result to <code class="highlighter-rouge">RecordDataSchema</code>.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="nc">RecordDataSchema</span><span class="o">)</span><span class="n">com</span><span class="o">.</span><span class="na">linkedin</span><span class="o">.</span><span class="na">data</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">DataTemplateUtil</span><span class="o">.</span><span class="na">getSchema</span><span class="o">(</span><span class="nc">MyRecord</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

                     </div>
                   </div>
</div>



      <footer class="page-footer">
    <div class="container">
      <div class="row">
        <div class="col s6">
          <h5>Rest.li</h5>
          <p class="text-lighten-4">Rest.li is an open source REST framework for building robust, scalable RESTful architectures using type-safe bindings and asynchronous, non-blocking IO. Rest.li fills a niche for applying RESTful principles at scale with an end-to-end developer workflow for building REST APIs, which promotes clean REST practices, uniform interface design and consistent data modeling.</p>
        </div>
        <div class="col s5 offset-s1">
          <h5 class="black-text">Community</h5>
          <ul>
              <li>GitHub <a class="" href="https://github.com/linkedin/rest.li">Rest.li</a></li>
              <li>LinkedIn <a class="" href="https://www.linkedin.com/groups/4855943/">Rest.li Group</a></li>
            <li>Follow us on twitter: <a class="" href="https://twitter.com/rest_li"> @rest_li</a></li>
            <li>Issue Tracking: <a class="" href="https://github.com/linkedin/rest.li/issues">GitHub issue tracking</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
        <div class="container">
            <div class="row">
              <div class="col s6">
                      Copyright 2018 LinkedIn Corporation </br>
                      This work is licensed under a <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.  </br>
                      For clarity, no trademark is licensed.
                      </br></br>
              </div>
              <div class="col s5 offset-s1">
                      This work was made by using Jekyll (and a Jekyll Starter Template)</br>
                      <a target="_blank" href="https://github.com/macrod68/jekyll-materialize-starter-template">https://github.com/macrod68/jekyll-materialize-starter-template</a></br>
                      Copyright © 2017 Marco Damiani. Powered by <a target="_blank" href="http://jekyllrb.com/">Jekyll</a></br>
                      License:<a target="_blank" href="https://opensource.org/licenses/MIT">MIT</a>
              </div>
            </div>
        </div>
    </div>
    <script>
      $(function() {
        return $("h2, h3, h4, h5, h6").each(function(i, el) {
          var $el, icon, id;
          $el = $(el);
          id = $el.attr('id');
          icon = '<i class="fa fa-link"></i>';
          if (id) {
            return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
          }
        });
      });
      </script>
</footer>

      
    <!--  Scripts-->                                                                               
<script src="/rest.li/assets/js/jquery.min.js"></script>
<script src="/rest.li/assets/js/materialize.min.js"></script>
<script src="/rest.li/assets/js/init.js"></script>

  </body>

</html>
